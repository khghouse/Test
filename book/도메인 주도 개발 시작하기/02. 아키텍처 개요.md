
## 네 개의 영역

표현, 응용, 도메인, 인프라스트럭처 네 개의 영역으로 아키텍처를 설계한다.

표현 영역
- 사용자의 요청을 받아 응용 영역에 전달하고 응용 영역의 처리 결과를 다시 사용자에게 보여주는 역할을 한다.
- 웹 애플리케이션의 표현 영역은 HTTP 요청을 응용 영역이 필요로 하는 형식으로 변환하여 전달한다.
- 응용 영역의 응답을 HTTP 응답으로 변환하여 전송한다.

응용 영역
- 시스템이 사용자에게 제공해야 할 기능을 구현한다.
  - 주문 등록, 주문 취소, 상품 상세 조회 등
- 응용 영역은 기능을 구현하기 위해 도메인 영역의 도메인 모델을 사용한다.
  - 로직을 직접 수행하기보다는 도메인 모델에 로직 수행을 위임한다.
  - 예) 주문 취소 로직을 직접 구현하지 않고 Order 객체에 취소 처리를 위임

도메인 영역
- 도메인 모델과 도메인의 핵심 로직을 구현한다.

인프라스트럭처 영역
- 구현 기술에 대한 것을 다룬다.
  - RDBMS 연동을 처리하고 메시징 큐에 메시지를 전송하거나 수신하는 기능을 구현한다.
  - 몽고DB, 레디스와의 데이터 연동을 처리한다.

<br />

## 계층 구조 아키텍처

네 영역을 구성할 때 많이 사용하는 아키텍처는 다음과 같은 계층 구조이다.  
- 표현 -> 응용 -> 도메인 -> 인프라스트럭처

계층 구조의 특성상 상위 계층에서 하위 계층으로의 의존만 존재하고, 하위 계층은 상위 계층에 의존하지 않는다.  
또한 계층 구조를 엄격하게 적용한다면 응용 계층은 도메인 계층에만 의존을 가져야 하지만 구현의 편리함을 위해서 인프라스트럭처에 바로 의존을 가지기도 한다.

<br />

## DIP

가격 할인 계산을 하려면 고객 정보를 구해야 하고, 구한 고객 정보와 주문 정보를 이용해서 룰을 실행해야 한다.

이때 "가격 할인 계산"은 의미 있는 단일 기능으로 고수준 모듈이고, "고객 정보 조회" "주문 정보를 이용한 할인 금액 계산"은 하위 기능을 실제로 구현한 것으로 저수준 모듈이라고 한다.

고수준 모듈이 저소준 모듈을 사용하면 구현 변경과 테스트가 어렵다는 문제가 발생한다.

DIP는 "의존 역전 원칙"으로 저수준 모듈이 고수준 모듈에 의존하게 되는 것을 말한다. 그러기 위해 인터페이스 또는 추상 클래스를 사용한다.
- DIP 적용 전 : CalculateDiscountService (의존)-> DroolsRuleEngine
- DIP 적용 후 : CalculateDiscountService (의존)-> RuleEngine <-(구현) DroolsRuleEngine

인프라스트럭처 영역은 구현 기술을 다루는 저수준 모듈이고 응용 영역과 도메인 영역은 고수준 모듈이다.
- DIP를 적용한 아키텍처는 인프라스트럭처 영역이 응용 영역과 도메인 영역에 의존하는 구조가 된다.

<br />

## 도메인 영역의 주요 구성요소

도메인 영역의 주요 구성 요소
- 엔티티 : 고유 식별자를 갖는 객체로 주문, 회원, 상품과 같은 도메인의 고유한 개념을 표현한다.
- 밸류 : 고유 식별자를 갖지 않는 객체로 주소, 금액과 같이 개념적으로 하나인 값을 표현할 때 사용한다.
- 애그리거트 : 연관된 엔티티와 밸류 객체를 개념적으로 하나로 묶은 것이다. Order, OrderLine, Orderer를 주문 애그리거트로 묶을 수 있다.
- 리포지터리 : 도메일 모델의 영속성을 처리한다.
- 도메인 서비스 : 특정 엔티티에 속하지 않은 도메인 로직을 제공한다. "할인 금액 계산"은 상품, 쿠폰, 회원 등급, 구매 금액 등 다양한 조건을 이용하여 구현하게 되는데 이처럼 여러 엔티티와 밸류를 필요로 하면 도메인 서비스에서 로직을 구현한다.

DB 테이블의 엔티티와 도메인 모델의 엔티티의 차이점
- 도메인 모델 엔티티는 데이터와 함께 도메인 기능을 함께 제공한다.
- 밸류 타입을 이용해서 표현할 수 있다.

